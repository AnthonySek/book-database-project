<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Authors</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    h1 { margin-bottom: 6px; }
    .nav a { margin-right: 12px; }
    .wrap { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 24px; margin-top: 16px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 16px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 10px; border-bottom: 1px solid #eee; }
    input { width: 100%; padding: 10px; margin: 6px 0 12px; }
    button { padding: 10px 14px; cursor: pointer; }
    .danger { background: #ffe5e5; border: 1px solid #ffb3b3; }
  </style>
</head>
<body>
  <h1>Authors</h1>
  <div class="nav">
    <a href="/books.html">Books</a>
    <a href="/authors.html"><b>Authors</b></a>
    <a href="/publishers.html">Publishers</a>
  </div>
  <p>This page uses the Spring Boot REST endpoints: GET /authors, POST /authors, DELETE /authors/{id}</p>

  <div class="wrap">
    <div class="card">
      <h2>All Authors</h2>
      <button onclick="loadAuthors()">Refresh</button>
      <div style="height:12px"></div>
      <table>
        <thead>
          <tr>
            <th style="width:80px;">ID</th>
            <th>Name</th>
            <th style="width:110px;">Delete</th>
          </tr>
        </thead>
        <tbody id="authorRows"></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Add an Author</h2>
      <label>Name</label>
      <input id="name" placeholder="Enter author name" />
      <button onclick="addAuthor()">Add Author</button>
      <p id="msg"></p>
    </div>
  </div>

<script>
async function loadAuthors() {
  const res = await fetch("/authors");
  const authors = await res.json();

  const tbody = document.getElementById("authorRows");
  tbody.innerHTML = "";

  authors.forEach(a => {
    const tr = document.createElement("tr");

    const idTd = document.createElement("td");
    idTd.textContent = a.authorId;

    const nameTd = document.createElement("td");
    nameTd.textContent = a.name;

    const delTd = document.createElement("td");
    const btn = document.createElement("button");
    btn.textContent = "Delete";
    btn.className = "danger";
    btn.onclick = () => deleteAuthor(a.authorId);
    delTd.appendChild(btn);

    tr.appendChild(idTd);
    tr.appendChild(nameTd);
    tr.appendChild(delTd);
    tbody.appendChild(tr);
  });
}

async function addAuthor() {
  const name = document.getElementById("name").value.trim();
  const msg = document.getElementById("msg");
  msg.textContent = "";

  if (!name) {
    msg.textContent = "Name is required.";
    return;
  }

  const res = await fetch("/authors", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name })
  });

  if (!res.ok) {
    msg.textContent = "Failed to add author.";
    return;
  }

  document.getElementById("name").value = "";
  msg.textContent = "Author added!";
  await loadAuthors();
}

async function deleteAuthor(id) {
  const res = await fetch(`/authors/${id}`, { method: "DELETE" });
  if (res.ok) {
    await loadAuthors();
  } else {
    alert("Delete failed (maybe referenced by BookAuthor).");
  }
}

// auto-load on page open
loadAuthors();
</script>
</body>
</html>
